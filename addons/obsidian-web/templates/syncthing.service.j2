[Unit]
Description=Syncthing - Open Source Continuous File Synchronization
Documentation=man:syncthing(1)
After=network.target

[Service]
Type=simple
ExecStart=/usr/bin/syncthing -no-browser -no-restart -logflags=0
Restart=on-failure
RestartSec=5
SuccessExitStatus=3 4
RestartForceExitStatus=3 4

# Hardening
NoNewPrivileges=yes
PrivateTmp=yes
ProtectSystem=strict
ReadWritePaths={{ obsidian_vault_path }} {{ obsidian_syncthing_data_path }} /var/lib/syncthing
ProtectHome=yes
RemoveIPC=yes

# User
User={{ obsidian_syncthing_user }}
Group={{ obsidian_syncthing_user }}

# Environment
Environment="STNOUPGRADE=1"
Environment="STGUIADDRESS=127.0.0.1:{{ obsidian_syncthing_gui_port }}"

[Install]
WantedBy=default.target
